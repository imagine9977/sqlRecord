<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 
"-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper
	namespace="com.sqlrecord.sqlrecord.notice.model.dao.NoticeMapper">
	<sql id="selectNotice">
		SELECT
		NOTICE_NO noticeNo,
		NOTICE_TITLE noticeTitle,
		NOTICE_CATE noticeCategory,
		NOTICE_CONTENT noticeContent,
		to_char(RESDATE,'yyyy-mm-dd') resdate
		FROM
		NOTICE
	</sql>
	<sql id="selectFile">
		SELECT
		NFILE_NO nfileNo,
		NFILE_ORIGINAL originalName,
		NFILE_CHANGED changedName,
		NOTICE_NO noticeNo
		FROM
		NFILE
	</sql>

	<select id="findAll" resultType="notice">
		<include refid="selectNotice" />
		ORDER BY
		NOTICE_NO DESC
	</select>
	<select id="findByCate" parameterType="string"
		resultType="notice">
		<include refid="selectNotice" />
		WHERE
		NOTICE_CATE = #{noticeCategory}
		ORDER BY
		NOTICE_NO DESC
	</select>
	<select id="findById" resultType="notice" parameterType="_int">
		<include refid="selectNotice" />
		WHERE
		NOTICE_NO = #{noticeNo}
	</select>

	<select id="findFiles" resultType="com.sqlrecord.sqlrecord.notice.model.vo.NFile" parameterType="_int">
		<include refid="selectFile" />
		WHERE
		NOTICE_NO = #{noticeNo}
	</select>
	<select id="findFileById" resultType="com.sqlrecord.sqlrecord.notice.model.vo.NFile" parameterType="_int">
		<include refid="selectFile" />
		WHERE
		NFILE_NO = #{nfileNo}
	</select>
	<insert id="save" parameterType="notice" >
		INSERT INTO NOTICE 
		VALUES
		(NOTICE_SEQ.NEXTVAL, #{noticeTitle}, #{noticeCategory},
		#{noticeContent}, SYSDATE)
	</insert>
	<select id="getNoticeNo" resultType="int">
		SELECT NOTICE_SEQ.CURRVAL FROM DUAL
	</select>
	<insert id="saveFile"
		parameterType="com.sqlrecord.sqlrecord.notice.model.vo.NFile">
		INSERT INTO NFILE
		VALUES (NFILE_SEQ.NEXTVAL,
		#{originalName}, #{changedName},
		#{noticeNo})
	</insert>
	<delete id="delete" parameterType="_int">
		DELETE NOTICE
		WHERE
		NOTICE_NO =
		#{noticeNo}
	</delete>
	<delete id="deleteFiles" parameterType="_int">
		DELETE NFILE
		WHERE
		NOTICE_NO =
		#{noticeNo}
	</delete>
	<delete id="deleteFileByPosition" parameterType="_int">
    DELETE FROM NFILE
    WHERE NFILE_NO = #{nfileNo}
	</delete>
	<update id="update" parameterType="notice">
		UPDATE
		NOTICE
		SET
		NOTICE_TITLE=#{noticeTitle},
		NOTICE_CONTENT= #{noticeContent},
		NOTICE_CATE=#{noticeCategory}
		WHERE
		NOTICE_NO = #{noticeNo}
		
	</update>
	<update id="updateFile"
		parameterType="com.sqlrecord.sqlrecord.notice.model.vo.NFile">
		UPDATE NFILE
		SET
		NFILE_ORIGINAL = #{originalName},NFILE_CHANGD #{changedName}
	</update>
</mapper>